<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebook Architect - Presentación Interactiva</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://cdn.pyodide.org/v0.24.1/full/pyodide.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #3949ab;
            --accent: #00bcd4;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --background: #0a0e1a;
            --surface: #1e1e2e;
            --text: #ffffff;
            --muted: #a0a3bd;
            --border: #2a2d47;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-dark: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Header con navegación */
        .presentation-header {
            background: var(--gradient-dark);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Contenedor principal */
        .presentation-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero-section {
            text-align: center;
            padding: 4rem 0;
            background: var(--gradient-dark);
            border-radius: 20px;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(0,188,212,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s ease-out;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--muted);
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .demo-btn {
            background: var(--gradient-primary);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .demo-btn:active {
            transform: translateY(-1px);
        }

        /* Layout principal */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .code-panel, .output-panel {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel-header {
            background: var(--gradient-primary);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .panel-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .panel-content {
            padding: 1.5rem;
            height: 500px;
            overflow-y: auto;
        }

        /* Editor de código */
        .code-editor {
            background: #1e1e2e;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            height: 100%;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .code-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.2rem;
            opacity: 0;
            animation: typewriter 0.5s ease-out forwards;
        }

        .line-number {
            color: var(--muted);
            min-width: 30px;
            font-size: 0.8rem;
            margin-right: 1rem;
            user-select: none;
        }

        .code-content {
            flex: 1;
            white-space: pre-wrap;
        }

        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; font-style: italic; }
        .function { color: #dcdcaa; }
        .number { color: #b5cea8; }
        .operator { color: #d4d4d4; }

        /* Panel de salida */
        .output-content {
            height: 100%;
            overflow-y: auto;
        }

        .output-item {
            margin-bottom: 1rem;
            animation: slideInRight 0.5s ease-out;
        }

        .output-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
        }

        .output-body {
            background: rgba(0, 188, 212, 0.1);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        /* Visualizaciones */
        .viz-container {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .viz-placeholder {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
        }

        /* Dashboard de métricas */
        .metrics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .metric-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--muted);
            font-size: 0.9rem;
        }

        /* Logs y estado */
        .execution-logs {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-top: 2rem;
        }

        .logs-content {
            padding: 1rem;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .log-entry {
            display: flex;
            margin-bottom: 0.5rem;
            animation: slideInLeft 0.3s ease-out;
        }

        .log-time {
            color: var(--muted);
            margin-right: 1rem;
        }

        .log-level {
            margin-right: 1rem;
            font-weight: 600;
        }

        .log-level.info { color: var(--accent); }
        .log-level.success { color: var(--success); }
        .log-level.warning { color: var(--warning); }
        .log-level.error { color: var(--error); }

        .log-message {
            flex: 1;
        }

        /* Animaciones */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes typewriter {
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .typing-cursor {
            display: inline-block;
            background: var(--accent);
            width: 2px;
            height: 1.2rem;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .demo-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="presentation-header">
        <div class="header-content">
            <div class="logo">📘 Notebook Architect</div>
            <div class="nav-controls">
                <button class="nav-btn active" onclick="showDemo('overview')">🏠 Inicio</button>
                <button class="nav-btn" onclick="showDemo('data-analysis')">📊 Análisis</button>
                <button class="nav-btn" onclick="showDemo('machine-learning')">🤖 ML</button>
                <button class="nav-btn" onclick="showDemo('visualization')">📈 Viz</button>
                <button class="nav-btn" onclick="showDemo('ai-agent')">🧠 Agente</button>
                <button class="nav-btn" onclick="openMainApp()">🚀 App</button>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <div class="presentation-container">
        
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">🚀 Notebook Architect Web</h1>
                <p class="hero-subtitle">Plataforma interactiva para análisis de datos con Python real y IA integrada</p>
                <div class="demo-controls">
                    <button class="demo-btn" onclick="startLiveDemo()">
                        ▶️ Demo en Vivo
                    </button>
                    <button class="demo-btn" onclick="showFeatures()">
                        ✨ Características
                    </button>
                    <button class="demo-btn" onclick="openMainApp()">
                        🎯 Abrir App
                    </button>
                </div>
            </div>
        </section>

        <!-- Layout principal -->
        <div class="main-layout">
            <!-- Panel de código -->
            <div class="code-panel">
                <div class="panel-header">
                    <div class="panel-title">🐍 Editor Python</div>
                    <div class="panel-status">
                        <span class="status-dot"></span>
                        <span id="execution-status">Listo para ejecutar</span>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="code-editor" id="code-editor">
                        <!-- El código se mostrará aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Panel de salida -->
            <div class="output-panel">
                <div class="panel-header">
                    <div class="panel-title">📊 Resultados & Visualizaciones</div>
                    <div class="panel-status">
                        <span class="status-dot"></span>
                        <span id="output-status">Esperando ejecución</span>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="output-content" id="output-content">
                        <div class="viz-placeholder">
                            <h3>🎨 Visualizaciones en Tiempo Real</h3>
                            <p>Las gráficas y resultados aparecerán aquí cuando ejecutes código Python</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard de métricas -->
        <div class="metrics-dashboard">
            <div class="metric-card">
                <div class="metric-value" id="lines-executed">0</div>
                <div class="metric-label">Líneas Ejecutadas</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="visualizations-created">0</div>
                <div class="metric-label">Visualizaciones</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="packages-loaded">0</div>
                <div class="metric-label">Paquetes Cargados</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="execution-time">0ms</div>
                <div class="metric-label">Tiempo Ejecución</div>
            </div>
        </div>

        <!-- Logs de ejecución -->
        <div class="execution-logs">
            <div class="panel-header">
                <div class="panel-title">📝 Logs de Ejecución</div>
                <button class="nav-btn" onclick="clearLogs()">🗑️ Limpiar</button>
            </div>
            <div class="logs-content" id="execution-logs">
                <!-- Los logs aparecerán aquí -->
            </div>
        </div>
    </div>

    <script>
        // Estado global
        let pyodide = null;
        let isInitialized = false;
        let currentDemo = 'overview';
        let executionCount = 0;
        let visualizationCount = 0;
        let packageCount = 0;

        // Inicializar Pyodide
        async function initializePyodide() {
            if (isInitialized) return;
            
            addLog('info', 'Inicializando entorno Python...');
            updateStatus('Cargando Pyodide...');
            
            try {
                pyodide = await loadPyodide();
                addLog('success', 'Pyodide cargado correctamente');
                
                // Instalar paquetes esenciales
                addLog('info', 'Instalando paquetes Python...');
                await pyodide.loadPackage(['numpy', 'pandas', 'matplotlib']);
                packageCount = 3;
                updateMetric('packages-loaded', packageCount);
                
                // Configurar el entorno
                pyodide.runPython(`
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib
matplotlib.use('Agg')  # Backend para web
import io
import base64

# Funciones utilitarias
def get_sample_data(name='iris'):
    if name == 'iris':
        from sklearn.datasets import load_iris
        data = load_iris()
        df = pd.DataFrame(data.data, columns=data.feature_names)
        df['species'] = pd.Categorical.from_codes(data.target, data.target_names)
        return df
    elif name == 'sales':
        np.random.seed(42)
        return pd.DataFrame({
            'fecha': pd.date_range('2023-01-01', periods=100),
            'ventas': np.random.randn(100).cumsum() + 100,
            'region': np.random.choice(['Norte', 'Sur', 'Este', 'Oeste'], 100),
            'producto': np.random.choice(['A', 'B', 'C'], 100)
        })
    else:
        return pd.DataFrame({'x': range(10), 'y': np.random.randn(10)})

def create_plot():
    plt.figure(figsize=(8, 6))
    return plt

def plot_to_base64():
    buf = io.BytesIO()
    plt.savefig(buf, format='png', dpi=100, bbox_inches='tight')
    buf.seek(0)
    img_str = base64.b64encode(buf.read()).decode()
    plt.close()
    return f"data:image/png;base64,{img_str}"
                `);
                
                addLog('success', 'Entorno Python configurado');
                updateStatus('Listo para ejecutar');
                isInitialized = true;
                
            } catch (error) {
                addLog('error', `Error al inicializar: ${error.message}`);
                updateStatus('Error en inicialización');
            }
        }

        // Demos predefinidos
        const demos = {
            'data-analysis': {
                title: '📊 Análisis de Datos',
                code: `# Análisis automático de datos
import pandas as pd
import numpy as np

# Cargar dataset de ejemplo
print("🔍 Cargando dataset Iris...")
df = get_sample_data('iris')

print(f"📊 Dataset cargado: {df.shape[0]} filas, {df.shape[1]} columnas")
print("\\n📋 Información del dataset:")
print(df.info())

print("\\n📈 Estadísticas descriptivas:")
print(df.describe())

print("\\n🎯 Distribución por especies:")
print(df['species'].value_counts())

# Crear visualización
plt = create_plot()
df.boxplot(by='species', figsize=(12, 8))
plt.title('Distribución de Características por Especie')
plt.tight_layout()

print("\\n✅ Análisis completado!")`,
                description: 'Carga y analiza datasets automáticamente'
            },
            
            'machine-learning': {
                title: '🤖 Machine Learning',
                code: `# Modelo de Machine Learning
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, classification_report

print("🤖 Iniciando entrenamiento de modelo ML...")

# Preparar datos
df = get_sample_data('iris')
X = df.drop('species', axis=1)
y = df['species']

print(f"📊 Características: {X.shape[1]}")
print(f"📊 Muestras: {X.shape[0]}")

# Dividir datos
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

# Entrenar modelo
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# Predicciones
y_pred = model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)

print(f"\\n🎯 Precisión del modelo: {accuracy:.2%}")
print(f"📊 Muestras de entrenamiento: {len(X_train)}")
print(f"📊 Muestras de prueba: {len(X_test)}")

# Visualizar importancia de características
plt = create_plot()
importance = model.feature_importances_
features = X.columns
plt.figure(figsize=(10, 6))
plt.barh(features, importance)
plt.title('Importancia de Características')
plt.xlabel('Importancia')
plt.tight_layout()

print("\\n✅ Modelo entrenado exitosamente!")`,
                description: 'Entrena modelos de ML con algoritmos avanzados'
            },
            
            'visualization': {
                title: '📈 Visualizaciones',
                code: `# Visualizaciones avanzadas
import matplotlib.pyplot as plt
import seaborn as sns

print("🎨 Creando visualizaciones avanzadas...")

# Cargar datos
df = get_sample_data('sales')

print(f"📊 Dataset de ventas: {df.shape[0]} registros")

# Configurar estilo
plt.style.use('seaborn-v0_8')

# Crear subplot con múltiples gráficos
fig, axes = plt.subplots(2, 2, figsize=(15, 12))

# Gráfico 1: Tendencia de ventas
axes[0,0].plot(df['fecha'], df['ventas'], color='#667eea', linewidth=2)
axes[0,0].set_title('📈 Tendencia de Ventas en el Tiempo')
axes[0,0].set_xlabel('Fecha')
axes[0,0].set_ylabel('Ventas')

# Gráfico 2: Ventas por región
region_sales = df.groupby('region')['ventas'].sum()
axes[0,1].bar(region_sales.index, region_sales.values, color=['#f093fb', '#f5576c', '#4facfe', '#00f2fe'])
axes[0,1].set_title('💼 Ventas Totales por Región')
axes[0,1].set_ylabel('Ventas Totales')

# Gráfico 3: Distribución de ventas
axes[1,0].hist(df['ventas'], bins=20, color='#667eea', alpha=0.7)
axes[1,0].set_title('📊 Distribución de Ventas')
axes[1,0].set_xlabel('Ventas')
axes[1,0].set_ylabel('Frecuencia')

# Gráfico 4: Boxplot por producto
df.boxplot(column='ventas', by='producto', ax=axes[1,1])
axes[1,1].set_title('📦 Ventas por Producto')

plt.tight_layout()
plt.suptitle('🎯 Dashboard de Análisis de Ventas', fontsize=16, y=1.02)

print("\\n✅ Visualizaciones creadas!")`,
                description: 'Gráficos estáticos e interactivos con múltiples librerías'
            },
            
            'ai-agent': {
                title: '🧠 Agente IA Simulado',
                code: `# Simulación de Agente IA
import random
import time

print("🧠 Iniciando Agente IA Inteligente...")
print("💭 Analizando consulta del usuario...")

# Simular proceso de análisis del agente
steps = [
    "🔍 Analizando datos disponibles...",
    "🧮 Calculando estadísticas relevantes...", 
    "📊 Generando visualizaciones óptimas...",
    "🎯 Identificando patrones importantes...",
    "✨ Creando recomendaciones automáticas..."
]

for i, step in enumerate(steps, 1):
    print(f"[{i}/5] {step}")
    # Simular tiempo de procesamiento
    
# Generar análisis automático
df = get_sample_data('iris')

print("\\n🎯 Resultados del Análisis del Agente:")
print(f"📊 Dataset identificado: Iris con {df.shape[0]} muestras")
print(f"🔢 Características numéricas encontradas: {df.select_dtypes(include=[np.number]).shape[1]}")
print(f"🏷️ Clases de clasificación: {df['species'].nunique()}")

# Recomendaciones del agente
recommendations = [
    "💡 Recomiendo análisis de correlación entre características",
    "📈 Sugiero visualización con scatter plot para separabilidad",
    "🤖 Propongo modelo Random Forest para clasificación",
    "🎯 Accuracy esperada: >95% con validación cruzada"
]

print("\\n🧠 Recomendaciones del Agente:")
for rec in recommendations:
    print(f"  {rec}")

# Crear visualización recomendada por el agente
plt = create_plot()
colors = ['#ff6b6b', '#4ecdc4', '#45b7d1']
species = df['species'].unique()

for i, spec in enumerate(species):
    subset = df[df['species'] == spec]
    plt.scatter(subset['sepal length (cm)'], subset['sepal width (cm)'], 
               c=colors[i], label=spec, alpha=0.7, s=50)

plt.xlabel('Longitud del Sépalo (cm)')
plt.ylabel('Ancho del Sépalo (cm)')
plt.title('🌸 Análisis de Separabilidad - Generado por IA')
plt.legend()
plt.grid(True, alpha=0.3)

print("\\n✅ Análisis del Agente completado!")`,
                description: 'Asistente IA que genera y ejecuta código automáticamente'
            }
        };

        // Funciones de UI
        function addLog(level, message) {
            const logs = document.getElementById('execution-logs');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-level ${level}">${level.toUpperCase()}</span>
                <span class="log-message">${message}</span>
            `;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }

        function updateStatus(status) {
            document.getElementById('execution-status').textContent = status;
            document.getElementById('output-status').textContent = status;
        }

        function updateMetric(metric, value) {
            document.getElementById(metric).textContent = value;
        }

        function clearLogs() {
            document.getElementById('execution-logs').innerHTML = '';
        }

        // Mostrar código con efecto typewriter
        function displayCode(code, element) {
            element.innerHTML = '';
            const lines = code.split('\n');
            
            lines.forEach((line, index) => {
                setTimeout(() => {
                    const lineElement = document.createElement('div');
                    lineElement.className = 'code-line';
                    lineElement.style.animationDelay = `${index * 0.1}s`;
                    
                    lineElement.innerHTML = `
                        <span class="line-number">${index + 1}</span>
                        <span class="code-content">${highlightSyntax(line)}</span>
                    `;
                    
                    element.appendChild(lineElement);
                }, index * 100);
            });
        }

        // Resaltado de sintaxis básico
        function highlightSyntax(code) {
            return code
                .replace(/(import|from|def|class|if|else|for|while|try|except|return|print)/g, '<span class="keyword">$1</span>')
                .replace(/(['"].*?['"])/g, '<span class="string">$1</span>')
                .replace(/(#.*$)/gm, '<span class="comment">$1</span>')
                .replace(/(\d+\.?\d*)/g, '<span class="number">$1</span>');
        }

        // Ejecutar código Python
        async function executeCode(code) {
            if (!isInitialized) {
                await initializePyodide();
            }
            
            const startTime = performance.now();
            updateStatus('Ejecutando...');
            addLog('info', 'Iniciando ejecución de código');
            
            try {
                // Capturar output
                pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
                `);
                
                // Ejecutar código
                pyodide.runPython(code);
                
                // Obtener output
                const output = pyodide.runPython('sys.stdout.getvalue()');
                
                // Intentar obtener plot si existe
                let plotData = null;
                try {
                    plotData = pyodide.runPython('plot_to_base64()');
                } catch (e) {
                    // No hay plot, está bien
                }
                
                // Mostrar resultados
                displayOutput(output, plotData);
                
                const endTime = performance.now();
                const executionTime = Math.round(endTime - startTime);
                
                executionCount++;
                if (plotData) visualizationCount++;
                
                updateMetric('lines-executed', executionCount);
                updateMetric('visualizations-created', visualizationCount);
                updateMetric('execution-time', `${executionTime}ms`);
                
                updateStatus('Completado');
                addLog('success', `Código ejecutado en ${executionTime}ms`);
                
            } catch (error) {
                addLog('error', `Error de ejecución: ${error.message}`);
                updateStatus('Error');
                
                const errorOutput = document.createElement('div');
                errorOutput.className = 'output-item';
                errorOutput.innerHTML = `
                    <div class="output-header">
                        <span>❌</span>
                        <span>Error de Ejecución</span>
                    </div>
                    <div class="output-body" style="background: rgba(244, 67, 54, 0.1); border-left-color: var(--error);">
                        <pre style="color: var(--error); margin: 0;">${error.message}</pre>
                    </div>
                `;
                
                const outputContainer = document.getElementById('output-content');
                outputContainer.appendChild(errorOutput);
            }
        }

        // Mostrar output y visualizaciones
        function displayOutput(output, plotData) {
            const outputContainer = document.getElementById('output-content');
            outputContainer.innerHTML = '';
            
            // Mostrar texto de salida si existe
            if (output.trim()) {
                const textOutput = document.createElement('div');
                textOutput.className = 'output-item';
                textOutput.innerHTML = `
                    <div class="output-header">
                        <span>📋</span>
                        <span>Salida de Consola</span>
                    </div>
                    <div class="output-body">
                        <pre style="margin: 0; white-space: pre-wrap;">${output}</pre>
                    </div>
                `;
                outputContainer.appendChild(textOutput);
            }
            
            // Mostrar visualización si existe
            if (plotData) {
                const vizOutput = document.createElement('div');
                vizOutput.className = 'output-item';
                vizOutput.innerHTML = `
                    <div class="output-header">
                        <span>📊</span>
                        <span>Visualización Generada</span>
                    </div>
                    <div class="viz-container">
                        <img src="${plotData}" style="max-width: 100%; height: auto; border-radius: 8px;" alt="Visualización">
                    </div>
                `;
                outputContainer.appendChild(vizOutput);
            }
        }

        // Navegación entre demos
        function showDemo(demoName) {
            // Actualizar navegación
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentDemo = demoName;
            
            if (demoName === 'overview') {
                // Mostrar información general
                const codeEditor = document.getElementById('code-editor');
                codeEditor.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--muted);">
                        <h3>🏠 Bienvenido a Notebook Architect</h3>
                        <p>Selecciona una demo del menú superior para ver código Python en acción</p>
                        <br>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 2rem;">
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">📊</div>
                                <div><strong>Análisis de Datos</strong></div>
                                <div style="font-size: 0.8rem; color: var(--muted);">Carga y analiza datasets automáticamente</div>
                            </div>
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🤖</div>
                                <div><strong>Machine Learning</strong></div>
                                <div style="font-size: 0.8rem; color: var(--muted);">Entrena modelos con algoritmos avanzados</div>
                            </div>
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">📈</div>
                                <div><strong>Visualizaciones</strong></div>
                                <div style="font-size: 0.8rem; color: var(--muted);">Gráficos estáticos e interactivos</div>
                            </div>
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🧠</div>
                                <div><strong>Agente IA</strong></div>
                                <div style="font-size: 0.8rem; color: var(--muted);">Asistente que genera código automáticamente</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('output-content').innerHTML = `
                    <div class="viz-placeholder">
                        <h3>🎯 Plataforma Lista</h3>
                        <p>Python con Pyodide cargado y listo para ejecutar</p>
                        <div style="margin-top: 1rem;">
                            <div style="background: rgba(76, 175, 80, 0.2); padding: 0.5rem; border-radius: 4px; margin: 0.5rem 0;">
                                ✅ NumPy, Pandas, Matplotlib disponibles
                            </div>
                            <div style="background: rgba(76, 175, 80, 0.2); padding: 0.5rem; border-radius: 4px; margin: 0.5rem 0;">
                                ✅ Funciones utilitarias cargadas
                            </div>
                            <div style="background: rgba(76, 175, 80, 0.2); padding: 0.5rem; border-radius: 4px; margin: 0.5rem 0;">
                                ✅ Sistema de visualización configurado
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            const demo = demos[demoName];
            if (demo) {
                const codeEditor = document.getElementById('code-editor');
                displayCode(demo.code, codeEditor);
                
                // Auto-ejecutar después de mostrar el código
                setTimeout(() => {
                    executeCode(demo.code);
                }, 2000);
            }
        }

        // Iniciar demo en vivo
        async function startLiveDemo() {
            addLog('info', 'Iniciando demo en vivo...');
            
            if (!isInitialized) {
                await initializePyodide();
            }
            
            // Secuencia automática de demos
            const demoSequence = ['data-analysis', 'machine-learning', 'visualization', 'ai-agent'];
            
            for (let i = 0; i < demoSequence.length; i++) {
                setTimeout(() => {
                    showDemo(demoSequence[i]);
                }, i * 8000); // 8 segundos entre demos
            }
        }

        // Mostrar características
        function showFeatures() {
            document.getElementById('output-content').innerHTML = `
                <div style="padding: 1rem;">
                    <h3 style="margin-bottom: 1rem; color: var(--accent);">✨ Características Principales</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                            <h4>🐍 Python Real en el Navegador</h4>
                            <p>Ejecuta código Python completo con Pyodide - sin servidor necesario</p>
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                            <h4>📊 Librerías Científicas Completas</h4>
                            <p>NumPy, Pandas, Matplotlib, Scikit-learn y más - todo disponible instantáneamente</p>
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                            <h4>🎨 Visualizaciones Avanzadas</h4>
                            <p>Gráficos estáticos e interactivos con múltiples librerías de visualización</p>
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                            <h4>🤖 Integración con IA</h4>
                            <p>Agentes inteligentes que escriben y ejecutan código automáticamente</p>
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px;">
                            <h4>📱 Diseño Responsive</h4>
                            <p>Interfaz adaptable que funciona perfecto en cualquier dispositivo</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Abrir app principal
        function openMainApp() {
            window.open('index.html', '_blank');
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            // Mostrar overview por defecto
            showDemo('overview');
            
            // Inicializar Pyodide en background
            setTimeout(initializePyodide, 1000);
            
            addLog('info', 'Presentación cargada - listo para demostrar');
        });
    </script>
</body>
</html>
